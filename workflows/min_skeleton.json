{"id":"LTZJrc7tYwv6Qm6a5wtZ0","name":"Imm supabase","nodes":[{"id":"1870e6a9-6b02-4de6-94e8-23210c9e7341","name":"Webhook Wassender","type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-6944,232],"parameters":{"path":"wassender-immobilier"},"webhookId":"wassender-immobilier-webhook"},{"id":"7f18d7ba-eb72-4266-a5e4-f4f56f7426e8","name":"Normaliser Webhook","type":"n8n-nodes-base.code","typeVersion":2,"position":[-6720,232],"parameters":{"jsCode":"// TODO"}},{"id":"7730ae8a-d24e-4784-bb61-01d7bea272ea","name":"Est un Groupe?","type":"n8n-nodes-base.if","typeVersion":2,"position":[-6496,232],"parameters":{}},{"id":"7d4b40bd-c354-40b5-9827-63e6a9387748","name":"Recuperer Nom Groupe","type":"n8n-nodes-base.httpRequest","typeVersion":4.4,"position":[-6272,40],"parameters":{}},{"id":"e35a8bb3-ab78-483f-9939-a98db0666afd","name":"Extraire Nom Groupe","type":"n8n-nodes-base.code","typeVersion":2,"position":[-6048,40],"parameters":{"jsCode":"// TODO"}},{"id":"2d69d84d-7d16-42bb-8ecb-afbed092f91d","name":"Message Sortant?","type":"n8n-nodes-base.if","typeVersion":2,"position":[-5824,40],"parameters":{}},{"id":"df79859e-b1fc-4f03-9401-5623ee2f508c","name":"Ignorer sortant","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-5600,-56],"parameters":{}},{"id":"e84792de-cf1c-4851-bfc8-f8e14d498682","name":"Extraction Commune","type":"n8n-nodes-base.code","typeVersion":2,"position":[-5600,136],"parameters":{"jsCode":"// TODO"}},{"id":"d79663c6-b4a9-4641-8acd-209e30fc4ac9","name":"Contenu Exploitable?","type":"n8n-nodes-base.if","typeVersion":2,"position":[-5376,136],"parameters":{}},{"id":"1d97c675-1aa6-48f1-bbfe-abb6276bcd08","name":"Ignorer Sticker","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-5152,236],"parameters":{}},{"id":"e5ff6a75-a492-44c5-a522-19893114dbc6","name":"Audio dans Groupe?","type":"n8n-nodes-base.if","typeVersion":2,"position":[-5152,-32],"parameters":{}},{"id":"9d167600-1ec5-4ecc-afa4-9987d63a478c","name":"Decrypter Audio Groupe","type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-4808,-104],"parameters":{}},{"id":"7045bd46-ca21-4d42-aac7-43a064261992","name":"Telecharger Audio Groupe","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-4400,-104],"parameters":{}},{"id":"e0e75f09-cf42-4586-9251-78db9c63147b","name":"Transcrire Audio Groupe","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":2.1,"position":[-4112,-104],"parameters":{"resource":"audio","operation":"transcribe"},"credentials":{"openAiApi":{"id":"toKKNKCxt5GPmAor","name":"API Agent Immo"}}},{"id":"a165a347-85c0-4ed5-86ae-595959679fd9","name":"Injecter Transcription","type":"n8n-nodes-base.code","typeVersion":2,"position":[-3888,-104],"parameters":{"jsCode":"// TODO"}},{"id":"4ac7354b-61ad-460a-86d0-b2a0f43787e5","name":"Chercher Publication Existante","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-3664,-32],"parameters":{}},{"id":"87fbade1-5f61-4249-bc5a-2d3fd9b4d029","name":"Generer Publication ID","type":"n8n-nodes-base.code","typeVersion":2,"position":[-3440,-32],"parameters":{"jsCode":"// TODO"}},{"id":"217b2469-374b-411d-a872-0fae6df20a3e","name":"A une Image?","type":"n8n-nodes-base.if","typeVersion":2,"position":[-3216,-32],"parameters":{}},{"id":"0d4858a7-eca3-4655-be3e-84119229beae","name":"Decrypter Image","type":"n8n-nodes-base.httpRequest","typeVersion":4.4,"position":[-2992,-128],"parameters":{}},{"id":"adf883be-846a-43b5-b3cd-3e9f8abf6ec1","name":"Verifier Decryptage","type":"n8n-nodes-base.code","typeVersion":2,"position":[-2768,-128],"parameters":{"jsCode":"// TODO"}},{"id":"27ef3ccd-4fe8-40bb-85b2-f1478945c88f","name":"Decryptage OK?","type":"n8n-nodes-base.if","typeVersion":2,"position":[-2544,-128],"parameters":{}},{"id":"3112e81a-6f93-4a37-aa8b-f6d11023ca4d","name":"Upload ImgBB","type":"n8n-nodes-base.httpRequest","typeVersion":4.4,"position":[-2320,-224],"parameters":{}},{"id":"8621613c-afa5-46c9-b703-c9f9f28f2eef","name":"Construire Donnees Image","type":"n8n-nodes-base.code","typeVersion":2,"position":[-2096,-224],"parameters":{"jsCode":"// TODO"}},{"id":"e20ec802-311d-479f-8117-b5c4975b99fa","name":"Fallback Image","type":"n8n-nodes-base.code","typeVersion":2,"position":[-2096,20],"parameters":{"jsCode":"// TODO"}},{"id":"d26672d1-6c96-4cbe-9223-5ede90d149cb","name":"Supabase IMAGES","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1872,-128],"parameters":{}},{"id":"ccdf78e7-ca50-47d1-8825-a1911c865158","name":"A aussi du texte?","type":"n8n-nodes-base.if","typeVersion":2,"position":[-1648,-128],"parameters":{}},{"id":"b0ed683d-d866-4223-bc0e-7645e6a52553","name":"Preparer Image Seule","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1424,-32],"parameters":{"jsCode":"// TODO"}},{"id":"3698b692-4f30-43cf-a186-ff8aed8c1b39","name":"Preparer Pub Image Texte","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1424,-224],"parameters":{"jsCode":"// TODO"}},{"id":"df154197-fca4-4571-9c00-51a57bb0e197","name":"Preparer Pub Texte","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1424,188],"parameters":{"jsCode":"// TODO"}},{"id":"9268cc89-a649-4f0a-b0fd-1e3cb9ac84e3","name":"Nouvelle Publication?","type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-1200,-32],"parameters":{}},{"id":"11c7ef45-05e5-48a8-93fe-bff82b65f96f","name":"Supabase PUBLICATION","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-976,-128],"parameters":{}},{"id":"7c03e041-ef97-435c-a890-4d40c2cad26a","name":"Image rattachee - Ignorer IA","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-976,64],"parameters":{}},{"id":"88d45752-12c6-4d07-8cbc-3a614d9bc5ca","name":"Extraire Donnees Publication","type":"n8n-nodes-base.code","typeVersion":2,"position":[-752,-128],"parameters":{"jsCode":"// TODO"}},{"id":"efa7540f-87c4-4a90-a06f-9202cd00da2e","name":"Analyse IA Immobilier","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":2.1,"position":[-528,-128],"parameters":{},"credentials":{"openAiApi":{"id":"toKKNKCxt5GPmAor","name":"API Agent Immo"}}},{"id":"0a134868-f3f3-4ae0-92a2-f6e3e52b0b3a","name":"Normaliser Prix","type":"n8n-nodes-base.code","typeVersion":2,"position":[-176,-128],"parameters":{"jsCode":"// TODO"}},{"id":"be241e15-a8e0-4976-af5b-1174fe37c7eb","name":"Lecture Locaux","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[48,-128],"parameters":{}},{"id":"a536ff46-de40-4279-9797-ad93d815c5a9","name":"Detecteur Doublons Locaux","type":"n8n-nodes-base.code","typeVersion":2,"position":[272,-128],"parameters":{"jsCode":"// TODO"}},{"id":"49822806-190f-4655-bcd0-51e03f5cceab","name":"Doublon detecte?","type":"n8n-nodes-base.if","typeVersion":2.3,"position":[496,-128],"parameters":{}},{"id":"6145ff42-4a1f-4a36-9730-ac07a9313d1a","name":"Doublon - Ignorer","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[720,-224],"parameters":{}},{"id":"a4d13a4e-01ba-4e74-9379-85cc28662ca4","name":"Donnees valides?","type":"n8n-nodes-base.if","typeVersion":2.3,"position":[720,-32],"parameters":{}},{"id":"8c1a849e-1f65-41da-9880-3d7fe140e01a","name":"Sauvegarder Local","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[944,-128],"parameters":{}},{"id":"b62cf047-909c-41e0-b0b0-b5849b9ddf4c","name":"Donnees vides - Ignorer","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[944,64],"parameters":{}},{"id":"426c13a7-038b-4c20-8f9d-342e16c0aa03","name":"Message Sortant?1","type":"n8n-nodes-base.if","typeVersion":2,"position":[-6272,428],"parameters":{}},{"id":"dabfaf05-5ee1-465e-8f37-ac746cc8e3a6","name":"Ignorer (sortant)1","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-6048,332],"parameters":{}},{"id":"b8b32b19-edac-4b7a-bf13-28f7049a50b5","name":"Audio ou Texte?1","type":"n8n-nodes-base.if","typeVersion":2,"position":[-6048,524],"parameters":{}},{"id":"982ee01e-7443-4c0d-8244-34f5ec0511a8","name":"Decrypter L'audio1","type":"n8n-nodes-base.httpRequest","typeVersion":4.3,"position":[-5824,428],"parameters":{}},{"id":"fc4e2ffc-41a1-431a-b176-5a7a88c7d418","name":"Telecharger Audio1","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-5600,428],"parameters":{}},{"id":"476795df-fa35-451d-a145-7f225a06b41f","name":"Transcribe a recording1","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":2.1,"position":[-5376,428],"parameters":{"resource":"audio","operation":"transcribe"},"credentials":{"openAiApi":{"id":"toKKNKCxt5GPmAor","name":"API Agent Immo"}}},{"id":"a278bca3-a9be-4cd5-999c-84621b4ca149","name":"Recuperer l'audio en text1","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-5152,428],"parameters":{}},{"id":"e997485f-12c1-4dd7-82d3-08c350083182","name":"Recuperer le message texte1","type":"n8n-nodes-base.code","typeVersion":2,"position":[-5152,620],"parameters":{"jsCode":"// TODO"}},{"id":"6f1a6921-3245-45a8-ad9e-b6d852c30917","name":"Agent Conversationnel1","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3.1,"position":[-4872,524],"parameters":{}},{"id":"2dadca18-6c7c-4a16-b7d9-593389284a5a","name":"OpenAI Chat Model1","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[-4928,748],"parameters":{},"credentials":{"openAiApi":{"id":"toKKNKCxt5GPmAor","name":"API Agent Immo"}}},{"id":"84c2c3ed-1cb3-4988-9cae-4301b2f022bc","name":"Simple Memory1","type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[-4800,748],"parameters":{}},{"id":"aaff9d2c-67c3-48d6-af34-bc5e9d2e2b5e","name":"Outil Recherche Locaux","type":"@n8n/n8n-nodes-langchain.toolCode","typeVersion":1.1,"position":[-4672,748],"parameters":{"jsCode":"// TODO"}},{"id":"2f25dd86-6004-4b31-9e5e-43566e35f919","name":"Agent Analyseur1","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":2.1,"position":[-4464,524],"parameters":{},"credentials":{"openAiApi":{"id":"toKKNKCxt5GPmAor","name":"API Agent Immo"}}},{"id":"cb04c94f-bfc8-404a-9da8-98c0081bf7cf","name":"Parser Analyse1","type":"n8n-nodes-base.code","typeVersion":2,"position":[-4112,524],"parameters":{"jsCode":"// TODO"}},{"id":"b969ed5a-ee70-46c8-a26a-8547ad4a20c8","name":"Envoyer Reponse WhatsApp1","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-3888,236],"parameters":{}},{"id":"7df3021b-4a0f-48f8-94b1-f491de82f216","name":"Visite Programmee?1","type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-3888,620],"parameters":{}},{"id":"f9b1ab42-6c3a-4813-9b57-17effbc78cbe","name":"Pas de visite - Ignorer1","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-3664,716],"parameters":{}},{"id":"3421049b-7b42-4449-9a6b-6fbab94c5600","name":"Verifier Visite Existante","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-3664,524],"parameters":{}},{"id":"60723e3e-401e-4d2a-8d55-33b7443281fc","name":"Evaluer Resultat Visite","type":"n8n-nodes-base.code","typeVersion":2,"position":[-3440,524],"parameters":{"jsCode":"// TODO"}},{"id":"f1aee9a5-da7b-4eaf-978a-a3bafd7d2a4f","name":"Pas encore programmee?","type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-3216,524],"parameters":{}},{"id":"3570a9b0-d540-473b-bfa0-419e6263624b","name":"Enregistrer Visite Programmee","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2992,428],"parameters":{}},{"id":"3868dcb1-ac20-481b-945b-15e84c6263eb","name":"Chercher Local","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2768,428],"parameters":{}},{"id":"546eadce-b84e-47d0-bf73-5a8ab134736c","name":"Recherche Intelligente Local","type":"n8n-nodes-base.code","typeVersion":2,"position":[-2544,428],"parameters":{"jsCode":"// TODO"}},{"id":"d39fef38-03c6-4738-8b22-4303a6f0acc7","name":"Telephone Proprietaire Trouve?","type":"n8n-nodes-base.if","typeVersion":2.3,"position":[-2320,428],"parameters":{}},{"id":"8d355865-01b2-402d-9cfe-3a831f4b5207","name":"Notifier Proprietaire","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2096,332],"parameters":{}},{"id":"0b853c9d-8a4e-48ea-a90f-910ff5277f08","name":"Notifier Agence (Fallback)","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2096,524],"parameters":{}},{"id":"8aa7b935-f4d6-4653-8716-d8969f51597e","name":"Deja programmee - Ignorer","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-2992,620],"parameters":{}}],"connections":{"Webhook Wassender":{"main":[[{"node":"Normaliser Webhook","type":"main","index":0}]]},"Normaliser Webhook":{"main":[[{"node":"Est un Groupe?","type":"main","index":0}]]},"Est un Groupe?":{"main":[[{"node":"Recuperer Nom Groupe","type":"main","index":0}],[{"node":"Message Sortant?1","type":"main","index":0}]]},"Recuperer Nom Groupe":{"main":[[{"node":"Extraire Nom Groupe","type":"main","index":0}]]},"Extraire Nom Groupe":{"main":[[{"node":"Message Sortant?","type":"main","index":0}]]},"Message Sortant?":{"main":[[{"node":"Ignorer sortant","type":"main","index":0}],[{"node":"Extraction Commune","type":"main","index":0}]]},"Extraction Commune":{"main":[[{"node":"Contenu Exploitable?","type":"main","index":0}]]},"Contenu Exploitable?":{"main":[[{"node":"Audio dans Groupe?","type":"main","index":0}],[{"node":"Ignorer Sticker","type":"main","index":0}]]},"Audio dans Groupe?":{"main":[[{"node":"Decrypter Audio Groupe","type":"main","index":0}],[{"node":"Chercher Publication Existante","type":"main","index":0}]]},"Decrypter Audio Groupe":{"main":[[{"node":"Telecharger Audio Groupe","type":"main","index":0}]]},"Telecharger Audio Groupe":{"main":[[{"node":"Transcrire Audio Groupe","type":"main","index":0}]]},"Transcrire Audio Groupe":{"main":[[{"node":"Injecter Transcription","type":"main","index":0}]]},"Injecter Transcription":{"main":[[{"node":"Chercher Publication Existante","type":"main","index":0}]]},"Chercher Publication Existante":{"main":[[{"node":"Generer Publication ID","type":"main","index":0}]]},"Generer Publication ID":{"main":[[{"node":"A une Image?","type":"main","index":0}]]},"A une Image?":{"main":[[{"node":"Decrypter Image","type":"main","index":0}],[{"node":"Preparer Pub Texte","type":"main","index":0}]]},"Decrypter Image":{"main":[[{"node":"Verifier Decryptage","type":"main","index":0}]]},"Verifier Decryptage":{"main":[[{"node":"Decryptage OK?","type":"main","index":0}]]},"Decryptage OK?":{"main":[[{"node":"Upload ImgBB","type":"main","index":0}],[{"node":"Fallback Image","type":"main","index":0}]]},"Upload ImgBB":{"main":[[{"node":"Construire Donnees Image","type":"main","index":0}]]},"Construire Donnees Image":{"main":[[{"node":"Supabase IMAGES","type":"main","index":0}]]},"Fallback Image":{"main":[[{"node":"Supabase IMAGES","type":"main","index":0}]]},"Supabase IMAGES":{"main":[[{"node":"A aussi du texte?","type":"main","index":0}]]},"A aussi du texte?":{"main":[[{"node":"Preparer Pub Image Texte","type":"main","index":0}],[{"node":"Preparer Image Seule","type":"main","index":0}]]},"Preparer Image Seule":{"main":[[{"node":"Nouvelle Publication?","type":"main","index":0}]]},"Preparer Pub Image Texte":{"main":[[{"node":"Nouvelle Publication?","type":"main","index":0}]]},"Preparer Pub Texte":{"main":[[{"node":"Nouvelle Publication?","type":"main","index":0}]]},"Nouvelle Publication?":{"main":[[{"node":"Supabase PUBLICATION","type":"main","index":0}],[{"node":"Image rattachee - Ignorer IA","type":"main","index":0}]]},"Supabase PUBLICATION":{"main":[[{"node":"Extraire Donnees Publication","type":"main","index":0}]]},"Extraire Donnees Publication":{"main":[[{"node":"Analyse IA Immobilier","type":"main","index":0}]]},"Analyse IA Immobilier":{"main":[[{"node":"Normaliser Prix","type":"main","index":0}]]},"Normaliser Prix":{"main":[[{"node":"Lecture Locaux","type":"main","index":0}]]},"Lecture Locaux":{"main":[[{"node":"Detecteur Doublons Locaux","type":"main","index":0}]]},"Detecteur Doublons Locaux":{"main":[[{"node":"Doublon detecte?","type":"main","index":0}]]},"Doublon detecte?":{"main":[[{"node":"Doublon - Ignorer","type":"main","index":0}],[{"node":"Donnees valides?","type":"main","index":0}]]},"Donnees valides?":{"main":[[{"node":"Sauvegarder Local","type":"main","index":0}],[{"node":"Donnees vides - Ignorer","type":"main","index":0}]]},"Message Sortant?1":{"main":[[{"node":"Ignorer (sortant)1","type":"main","index":0}],[{"node":"Audio ou Texte?1","type":"main","index":0}]]},"Audio ou Texte?1":{"main":[[{"node":"Decrypter L'audio1","type":"main","index":0}],[{"node":"Recuperer le message texte1","type":"main","index":0}]]},"Decrypter L'audio1":{"main":[[{"node":"Telecharger Audio1","type":"main","index":0}]]},"Telecharger Audio1":{"main":[[{"node":"Transcribe a recording1","type":"main","index":0}]]},"Transcribe a recording1":{"main":[[{"node":"Recuperer l'audio en text1","type":"main","index":0}]]},"Recuperer l'audio en text1":{"main":[[{"node":"Agent Conversationnel1","type":"main","index":0}]]},"Recuperer le message texte1":{"main":[[{"node":"Agent Conversationnel1","type":"main","index":0}]]},"Agent Conversationnel1":{"main":[[{"node":"Agent Analyseur1","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Agent Conversationnel1","type":"ai_languageModel","index":0}]]},"Simple Memory1":{"ai_memory":[[{"node":"Agent Conversationnel1","type":"ai_memory","index":0}]]},"Outil Recherche Locaux":{"ai_tool":[[{"node":"Agent Conversationnel1","type":"ai_tool","index":0}]]},"Agent Analyseur1":{"main":[[{"node":"Parser Analyse1","type":"main","index":0}]]},"Parser Analyse1":{"main":[[{"node":"Envoyer Reponse WhatsApp1","type":"main","index":0},{"node":"Visite Programmee?1","type":"main","index":0}]]},"Visite Programmee?1":{"main":[[{"node":"Verifier Visite Existante","type":"main","index":0}],[{"node":"Pas de visite - Ignorer1","type":"main","index":0}]]},"Verifier Visite Existante":{"main":[[{"node":"Evaluer Resultat Visite","type":"main","index":0}]]},"Evaluer Resultat Visite":{"main":[[{"node":"Pas encore programmee?","type":"main","index":0}]]},"Pas encore programmee?":{"main":[[{"node":"Enregistrer Visite Programmee","type":"main","index":0}],[{"node":"Deja programmee - Ignorer","type":"main","index":0}]]},"Enregistrer Visite Programmee":{"main":[[{"node":"Chercher Local","type":"main","index":0}]]},"Chercher Local":{"main":[[{"node":"Recherche Intelligente Local","type":"main","index":0}]]},"Recherche Intelligente Local":{"main":[[{"node":"Telephone Proprietaire Trouve?","type":"main","index":0}]]},"Telephone Proprietaire Trouve?":{"main":[[{"node":"Notifier Proprietaire","type":"main","index":0}],[{"node":"Notifier Agence (Fallback)","type":"main","index":0}]]}}}